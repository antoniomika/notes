<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 2.32.13"/><title data-react-helmet="true">Bonjour Discovery Across Subnets Â· A personal blog and note taking site</title><meta data-react-helmet="true" charSet="utf-8"/><meta data-react-helmet="true" name="viewport" content="initial-scale=1.0, width=device-width"/><link as="script" rel="preload" href="/webpack-runtime-6c5d3617d53de854ad20.js"/><link as="script" rel="preload" href="/framework-643cd9d57cfac08fd2c4.js"/><link as="script" rel="preload" href="/1bfc9850-284bb63085f6cc17369b.js"/><link as="script" rel="preload" href="/app-c6ef5c2f96254335c1a0.js"/><link as="script" rel="preload" href="/commons-0b008caf945293618b83.js"/><link as="script" rel="preload" href="/component---src-gatsby-theme-code-notes-templates-note-js-b0f61fea6533f3ee3656.js"/><link as="fetch" rel="preload" href="/page-data/bonjour-across-subnets/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1322576299.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1437003973.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/467212769.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/467212769.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><script>(function() { try {
  var mode = localStorage.getItem('theme-ui-color-mode');
  if (!mode) return
  document.body.classList.add('theme-ui-' + mode);
} catch (e) {} })();</script><div id="___gatsby"><style data-emotion-css="1om1xv2">body{--theme-ui-colors-grayDark:var(--theme-ui-colors-grayDark,#2d3748);--theme-ui-colors-white:var(--theme-ui-colors-white,#fff);--theme-ui-colors-light:var(--theme-ui-colors-light,#f7fafc);--theme-ui-colors-dark:var(--theme-ui-colors-dark,#2d3748);--theme-ui-colors-text:var(--theme-ui-colors-text,hsl(210,38%,95%));--theme-ui-colors-background:var(--theme-ui-colors-background,hsl(285,5%,17%));--theme-ui-colors-scrollbar:var(--theme-ui-colors-scrollbar,hsl(285,5%,12%));--theme-ui-colors-backgroundTransparent:var(--theme-ui-colors-backgroundTransparent,hsla(285,5%,17%,0.72));--theme-ui-colors-contentBg:var(--theme-ui-colors-contentBg,#383539);--theme-ui-colors-primary:var(--theme-ui-colors-primary,hsl(345,100%,69%));--theme-ui-colors-primarySemiTransparent:var(--theme-ui-colors-primarySemiTransparent,hsl(345,100%,79%,0.5));--theme-ui-colors-secondary:var(--theme-ui-colors-secondary,#718096);--theme-ui-colors-muted:var(--theme-ui-colors-muted,hsl(210,5%,40%));--theme-ui-colors-success:var(--theme-ui-colors-success,#9ae6b4);--theme-ui-colors-info:var(--theme-ui-colors-info,#63b3ed);--theme-ui-colors-warning:var(--theme-ui-colors-warning,#faf089);--theme-ui-colors-danger:var(--theme-ui-colors-danger,#feb2b2);--theme-ui-colors-navHover:var(--theme-ui-colors-navHover,hsl(285,5%,13%));--theme-ui-colors-codeBackground:var(--theme-ui-colors-codeBackground,#2d2a2e);--theme-ui-colors-badgeBg:var(--theme-ui-colors-badgeBg,hsl(285,5%,17%));--theme-ui-colors-badgeBgHover:var(--theme-ui-colors-badgeBgHover,hsl(285,5%,20%));--theme-ui-colors-badgeBorder:var(--theme-ui-colors-badgeBorder,hsl(285,5%,12%));--theme-ui-colors-input:var(--theme-ui-colors-input,#ddd);--theme-ui-colors-code1:var(--theme-ui-colors-code1,hsl(345,100%,69%));--theme-ui-colors-code2:var(--theme-ui-colors-code2,#fc9867);--theme-ui-colors-code3:var(--theme-ui-colors-code3,#ffd866);--theme-ui-colors-code4:var(--theme-ui-colors-code4,#a9dc76);--theme-ui-colors-code5:var(--theme-ui-colors-code5,#78dce8);--theme-ui-colors-code6:var(--theme-ui-colors-code6,#ab9df2);--theme-ui-colors-code7:var(--theme-ui-colors-code7,#999988);color:var(--theme-ui-colors-text,hsl(210,38%,95%));background-color:var(--theme-ui-colors-background,hsl(285,5%,17%));}body.theme-ui-dark{--theme-ui-colors-text:var(--theme-ui-colors-modes-dark-text,#2d3748);--theme-ui-colors-background:var(--theme-ui-colors-modes-dark-background,hsl(210,38%,95%));--theme-ui-colors-scrollbar:var(--theme-ui-colors-modes-dark-scrollbar,hsl(210,20%,85%));--theme-ui-colors-backgroundTransparent:var(--theme-ui-colors-modes-dark-backgroundTransparent,hsla(210,38%,95%,0.72));--theme-ui-colors-contentBg:var(--theme-ui-colors-modes-dark-contentBg,#f7fafc);--theme-ui-colors-primary:var(--theme-ui-colors-modes-dark-primary,hsl(334,86%,48%));--theme-ui-colors-primarySemiTransparent:var(--theme-ui-colors-modes-dark-primarySemiTransparent,hsla(334,86%,48%,0.5));--theme-ui-colors-secondary:var(--theme-ui-colors-modes-dark-secondary,#718096);--theme-ui-colors-muted:var(--theme-ui-colors-modes-dark-muted,#e2e8f0);--theme-ui-colors-success:var(--theme-ui-colors-modes-dark-success,#9ae6b4);--theme-ui-colors-info:var(--theme-ui-colors-modes-dark-info,#63b3ed);--theme-ui-colors-warning:var(--theme-ui-colors-modes-dark-warning,#faf089);--theme-ui-colors-danger:var(--theme-ui-colors-modes-dark-danger,#feb2b2);--theme-ui-colors-navHover:var(--theme-ui-colors-modes-dark-navHover,#cbd5e0);--theme-ui-colors-codeBackground:var(--theme-ui-colors-modes-dark-codeBackground,#fbf2e9);--theme-ui-colors-badgeBg:var(--theme-ui-colors-modes-dark-badgeBg,hsl(210,25%,97%));--theme-ui-colors-badgeBgHover:var(--theme-ui-colors-modes-dark-badgeBgHover,hsl(210,25%,89%));--theme-ui-colors-badgeBorder:var(--theme-ui-colors-modes-dark-badgeBorder,hsl(207,24%,83%));--theme-ui-colors-input:var(--theme-ui-colors-modes-dark-input,#92A2B9);--theme-ui-colors-code1:var(--theme-ui-colors-modes-dark-code1,hsl(211,61%,23%));--theme-ui-colors-code2:var(--theme-ui-colors-modes-dark-code2,#fc9867);--theme-ui-colors-code3:var(--theme-ui-colors-modes-dark-code3,#e3116c);--theme-ui-colors-code4:var(--theme-ui-colors-modes-dark-code4,#d73a49);--theme-ui-colors-code5:var(--theme-ui-colors-modes-dark-code5,hsl(211,61%,43%));--theme-ui-colors-code6:var(--theme-ui-colors-modes-dark-code6,#6f42c1);--theme-ui-colors-code7:var(--theme-ui-colors-modes-dark-code7,#999988);}</style><style data-emotion-css="svsiph">*{box-sizing:border-box;}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.625;font-weight:400;font-size:1rem;}</style><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="yhthxk">*{box-sizing:border-box;}body{margin:0;}:root{font-size:16px;}@media (min-width:480px){:root{font-size:calc(1rem + ((1vw - 4.8px) * 0.2778));}}@media (min-width:1920px){:root{font-size:20px;}}</style><style data-emotion-css="1opvhak">.css-1opvhak{position:relative;top:0;right:0;bottom:0;left:0;overflow-x:hidden;overflow-y:auto;z-index:10;padding:2.5rem;background-color:var(--theme-ui-colors-contentBg,#383539);-webkit-transition:all 200ms ease-in-out;transition:all 200ms ease-in-out;box-shadow:0 0 6px -1px rgba(0,0,0,0.1),0 0 4px -1px rgba(0,0,0,0.06);border-radius:0;min-height:100vh;}@media screen and (min-width:40em){.css-1opvhak{position:fixed;top:1rem;right:1rem;bottom:1rem;left:240px;-webkit-transform:translateX(0);-ms-transform:translateX(0);transform:translateX(0);box-shadow:0 0 6px -1px rgba(0,0,0,0.1),0 0 4px -1px rgba(0,0,0,0.06);border-radius:0.25rem;min-height:unset;}}</style><style data-emotion-css="vvc0si">.css-vvc0si{box-sizing:border-box;margin:0;min-width:0;position:relative;top:0;right:0;bottom:0;left:0;overflow-x:hidden;overflow-y:auto;z-index:10;padding:2.5rem;background-color:var(--theme-ui-colors-contentBg,#383539);-webkit-transition:all 200ms ease-in-out;transition:all 200ms ease-in-out;box-shadow:0 0 6px -1px rgba(0,0,0,0.1),0 0 4px -1px rgba(0,0,0,0.06);border-radius:0;min-height:100vh;}@media screen and (min-width:40em){.css-vvc0si{position:fixed;top:1rem;right:1rem;bottom:1rem;left:240px;-webkit-transform:translateX(0);-ms-transform:translateX(0);transform:translateX(0);box-shadow:0 0 6px -1px rgba(0,0,0,0.1),0 0 4px -1px rgba(0,0,0,0.06);border-radius:0.25rem;min-height:unset;}}</style><main class="css-vvc0si"><style data-emotion-css="1qjd62t">.css-1qjd62t{margin-bottom:0.5rem;display:block;}@media screen and (min-width:40em){.css-1qjd62t{display:none;}}</style><style data-emotion-css="s7tziy">.css-s7tziy{box-sizing:border-box;margin:0;min-width:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding:0.25rem;width:32px;height:32px;color:inherit;background-color:transparent;border:none;border-radius:4px;margin-bottom:0.5rem;display:block;}@media screen and (min-width:40em){.css-s7tziy{display:none;}}</style><button title="Menu" aria-label="Toggle Menu" class="css-s7tziy"><style data-emotion-css="ipc245">.css-ipc245{box-sizing:border-box;margin:0;min-width:0;display:block;margin:0;}</style><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentcolor" viewBox="0 0 24 24" class="css-ipc245"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></button><style data-emotion-css="o44is">.css-o44is{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100%;}</style><style data-emotion-css="15c8zhg">.css-15c8zhg{box-sizing:border-box;margin:0;min-width:0;width:100%;max-width:900px;margin-left:auto;margin-right:auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100%;}</style><div class="css-15c8zhg"><style data-emotion-css="8fkoyy">.css-8fkoyy{margin-bottom:2rem;}</style><style data-emotion-css="193v69v">.css-193v69v{box-sizing:border-box;margin:0;min-width:0;margin-bottom:2rem;}</style><div class="css-193v69v"><style data-emotion-css="79elbk">.css-79elbk{position:relative;}</style><style data-emotion-css="15owl46">.css-15owl46{box-sizing:border-box;margin:0;min-width:0;position:relative;}</style><div class="css-15owl46"><style data-emotion-css="sktxvt">.css-sktxvt{position:absolute;top:50%;left:0.5rem;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);color:var(--theme-ui-colors-input,#ddd);pointer-events:none;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="css-sktxvt" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M15.7 13.3l-3.81-3.83A5.93 5.93 0 0 0 13 6c0-3.31-2.69-6-6-6S1 2.69 1 6s2.69 6 6 6c1.3 0 2.48-.41 3.47-1.11l3.83 3.81c.19.2.45.3.7.3.25 0 .52-.09.7-.3a.996.996 0 0 0 0-1.41v.01zM7 10.7c-2.59 0-4.7-2.11-4.7-4.7 0-2.59 2.11-4.7 4.7-4.7 2.59 0 4.7 2.11 4.7 4.7 0 2.59-2.11 4.7-4.7 4.7z"></path></svg><style data-emotion-css="13ck39u">.css-13ck39u{box-sizing:border-box;margin:0;min-width:0;display:block;width:100%;padding:0.5rem;-webkit-appearance:none;-moz-appearance:none;appearance:none;font-size:inherit;line-height:inherit;border:1px solid;border-radius:4px;color:inherit;background-color:transparent;border:0;border-bottom:1px solid var(--theme-ui-colors-input,#ddd);padding-left:2rem;border-radius:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";-webkit-transition:all 200ms ease-in-out;transition:all 200ms ease-in-out;}.css-13ck39u:focus{box-shadow:0 2px 0 var(--theme-ui-colors-primary,hsl(345,100%,69%));outline:none;border-color:var(--theme-ui-colors-primary,hsl(345,100%,69%));}</style><input value="" aria-label="Search" placeholder="Search notes" class="css-13ck39u"/></div></div><article><style data-emotion-css="1i385gf">.css-1i385gf{box-sizing:border-box;margin:0;min-width:0;margin-bottom:1.5rem;}</style><header class="css-1i385gf"><style data-emotion-css="kmbr3">.css-kmbr3{box-sizing:border-box;margin:0;min-width:0;font-family:inherit;font-weight:400;line-height:1.25;font-weight:700;font-size:3rem;margin-bottom:1rem;line-height:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><h1 class="css-kmbr3">Bonjour Discovery Across Subnets</h1><style data-emotion-css="120nvbq">.css-120nvbq{box-sizing:border-box;margin:0;min-width:0;margin-bottom:1rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><div class="css-120nvbq"></div><style data-emotion-css="4cffwv">.css-4cffwv{box-sizing:border-box;margin:0;min-width:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><div class="css-4cffwv"><style data-emotion-css="jma0kd">.css-jma0kd{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><style data-emotion-css="1rvt7oz">.css-1rvt7oz{box-sizing:border-box;margin:0;min-width:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="css-1rvt7oz"><style data-emotion-css="4ihca9">.css-4ihca9{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;margin-right:0.25rem;background-color:hsla(355,40%,60%,0.5);}</style><style data-emotion-css="xq0p9i">.css-xq0p9i{box-sizing:border-box;margin:0;min-width:0;border-radius:50px;color:var(--theme-ui-colors-text,hsl(210,38%,95%));background-color:var(--theme-ui-colors-badgeBg,hsl(285,5%,17%));-webkit-text-decoration:none;text-decoration:none;padding-left:0.5rem;padding-right:0.5rem;font-weight:400;font-size:0.7rem;-webkit-transition:all 200ms ease-in-out;transition:all 200ms ease-in-out;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;margin-right:0.25rem;background-color:hsla(355,40%,60%,0.5);}.css-xq0p9i:hover{-webkit-text-decoration:none;text-decoration:none;opacity:0.7;}</style><a class="css-xq0p9i" href="/tag/blog">blog</a></div></div></header><style data-emotion-css="mfqae4">.css-mfqae4{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.625;font-weight:400;color:var(--theme-ui-colors-text,hsl(210,38%,95%));margin-bottom:1.25rem;}</style><p class="css-mfqae4">In home automation, bonjour services can make one&#x27;s life extremely simple. Plug your device in, connect it to your network and load up your favorite home automation application, and poof! You have access to it automatically!</p><p class="css-mfqae4">This is the best case scenario, but there are times where you can&#x27;t necessarily connect the device directly to your network. This could be due to wanting added security between smart home devices and other networked devices (separate VLANs/subnets) or you don&#x27;t actually manage the device (a thermostat installed by your landlord). For these reasons, auto discovery may not be possible. This leaves you with the inability to benefit from automated setup and could prevent you from using said device.</p><p class="css-mfqae4">Maybe the platform you&#x27;re using allows you to connect to the device directly over IP, but sometimes this is more of a headache than warranted. Instead, you could use a tool to share bonjour broadcasts between separate networks. That&#x27;s where <style data-emotion-css="bxllfp">.css-bxllfp{-webkit-transition:all 200ms ease-in-out;transition:all 200ms ease-in-out;}.css-bxllfp:link,.css-bxllfp:visited{font-weight:700;color:var(--theme-ui-colors-text,hsl(210,38%,95%));-webkit-text-decoration:none;text-decoration:none;border-bottom:2px solid;border-bottom-color:var(--theme-ui-colors-primary,hsl(345,100%,69%));}.css-bxllfp:hover,.css-bxllfp:focus{color:var(--theme-ui-colors-primary,hsl(345,100%,69%));}</style><a href="https://github.com/antoniomika/bonjourproxy" class="css-bxllfp">bonjourproxy</a> comes in.</p><p class="css-mfqae4">bonjourproxy is a small tool that allows you to broadcast the relevant information required for autodiscovery to your separate network. It can be setup to broadcast any number of devices and can be configured for the type of information to broadcast.</p><p class="css-mfqae4">For example, let&#x27;s say you have a smart thermostat on a separate network but you want it to be discoverable by something like <a href="https://www.home-assistant.io/" class="css-bxllfp">Home Assistant</a> that exists on your main network. You can setup a service using a config like so:</p><style data-emotion-css="f8y5iy">.css-f8y5iy{padding:1rem;color:var(--theme-ui-colors-text,hsl(210,38%,95%));background-color:var(--theme-ui-colors-background,hsl(285,5%,17%));border-radius:0.25rem;overflow-x:auto;font-family:"IBM Plex Mono","JetBrains Mono","Fira Code","Input Mono",Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;}</style><style data-emotion-css="1cyhw3">.css-1cyhw3{padding:1rem;padding-top:0.5rem;margin-top:0;font-size:0.875rem;color:var(--theme-ui-colors-text,hsl(210,38%,95%));background-color:var(--theme-ui-colors-background,hsl(285,5%,17%));overflow-x:auto;border-radius:0 0 0.25rem 0.25rem;font-family:"IBM Plex Mono","JetBrains Mono","Fira Code","Input Mono",Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;}.css-1cyhw3 .comment,.css-1cyhw3 .prolog,.css-1cyhw3 .doctype,.css-1cyhw3 .cdata{color:var(--theme-ui-colors-code7,#999988);font-style:italic;}.css-1cyhw3 .namespace{opacity:0.7;}.css-1cyhw3 .string,.css-1cyhw3 .attr-value,.css-1cyhw3 .punctuation,.css-1cyhw3 .tag.script-punctuation,.css-1cyhw3 .tag.attr-value.punctuation{color:var(--theme-ui-colors-code3,#ffd866);}.css-1cyhw3 .entity,.css-1cyhw3 .url,.css-1cyhw3 .symbol,.css-1cyhw3 .number,.css-1cyhw3 .boolean,.css-1cyhw3 .constant,.css-1cyhw3 .property,.css-1cyhw3 .regex,.css-1cyhw3 .inserted,.css-1cyhw3 .attr-value,.css-1cyhw3 .tag.attr-value{color:var(--theme-ui-colors-text,hsl(210,38%,95%));}.css-1cyhw3 .function,.css-1cyhw3 .tag.function,.css-1cyhw3 .deleted,.css-1cyhw3 .variable,.css-1cyhw3 .unit{color:var(--theme-ui-colors-code3,#ffd866);}.css-1cyhw3 .function-variable{color:var(--theme-ui-colors-code6,#ab9df2);}.css-1cyhw3 .tag,.css-1cyhw3 .keyword,.css-1cyhw3 .selector,.css-1cyhw3 .attr-name,.css-1cyhw3 .tag.attr-name{color:var(--theme-ui-colors-code5,#78dce8);}.css-1cyhw3 .symbol,.css-1cyhw3 .tag.punctuation{color:var(--theme-ui-colors-code7,#999988);}.css-1cyhw3 .property,.css-1cyhw3 .number{color:var(--theme-ui-colors-code6,#ab9df2);}.css-1cyhw3 .rule,.css-1cyhw3 .class-name,.css-1cyhw3 .keyword.module,.css-1cyhw3 .operator,.css-1cyhw3 .tag{color:var(--theme-ui-colors-code1,hsl(345,100%,69%));}.css-1cyhw3 .function,.css-1cyhw3 .tag.function{color:var(--theme-ui-colors-code4,#a9dc76);}.css-1cyhw3::-webkit-scrollbar{width:0.5rem;height:0.5rem;}.css-1cyhw3::-webkit-scrollbar:hover{width:1rem;height:1rem;}.css-1cyhw3::-webkit-scrollbar-track{background-color:var(--theme-ui-colors-scrollbar,hsl(285,5%,12%));}.css-1cyhw3::-webkit-scrollbar-thumb{background-color:var(--theme-ui-colors-muted,hsl(210,5%,40%));}</style><style data-emotion-css="1u4j0n9">.css-1u4j0n9{position:relative;margin-top:1.5rem;margin-bottom:1.5rem;}</style><style data-emotion-css="byi6om">.css-byi6om{box-sizing:border-box;margin:0;min-width:0;position:relative;margin-top:1.5rem;margin-bottom:1.5rem;}</style><div class="css-byi6om"><style data-emotion-css="c2yjs7">.css-c2yjs7{border-radius:0.25rem 0.25rem 0 0;background-color:var(--theme-ui-colors-background,hsl(285,5%,17%));padding:0.5rem;padding-bottom:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style data-emotion-css="4aw43z">.css-4aw43z{box-sizing:border-box;margin:0;min-width:0;border-radius:0.25rem 0.25rem 0 0;background-color:var(--theme-ui-colors-background,hsl(285,5%,17%));padding:0.5rem;padding-bottom:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-4aw43z"><style data-emotion-css="1h1hzdy">.css-1h1hzdy{position:absolute;top:0;left:1rem;font-family:"IBM Plex Mono","JetBrains Mono","Fira Code","Input Mono",Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:0.7rem;background-color:hsla(85,40%,60%,0.5);text-transform:uppercase;padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem;line-height:1;border-radius:0 0 0.2rem 0.2rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;height:auto;}</style><style data-emotion-css="1quteuu">.css-1quteuu{box-sizing:border-box;margin:0;min-width:0;position:absolute;top:0;left:1rem;font-family:"IBM Plex Mono","JetBrains Mono","Fira Code","Input Mono",Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:0.7rem;background-color:hsla(85,40%,60%,0.5);text-transform:uppercase;padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem;line-height:1;border-radius:0 0 0.2rem 0.2rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;height:auto;}</style><div class="css-1quteuu">toml</div><style data-emotion-css="pbbfx5">.css-pbbfx5{box-sizing:border-box;margin:0;min-width:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:inline-block;text-align:center;line-height:inherit;-webkit-text-decoration:none;text-decoration:none;font-size:inherit;padding-left:1rem;padding-right:1rem;padding-top:0.5rem;padding-bottom:0.5rem;color:var(--theme-ui-colors-white,#fff);background-color:var(--theme-ui-colors-primary,hsl(345,100%,69%));border:0;border-radius:4px;padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem;font-size:0.7rem;background-color:var(--theme-ui-colors-badgeBg,hsl(285,5%,17%));-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;color:var(--theme-ui-colors-text,hsl(210,38%,95%));border:1px solid var(--theme-ui-colors-badgeBorder,hsl(285,5%,12%));border-radius:large;margin-left:auto;}.css-pbbfx5:hover,.css-pbbfx5:focus{background-color:var(--theme-ui-colors-badgeBgHover,hsl(285,5%,20%));}</style><button class="css-pbbfx5">Copy</button></div><style data-emotion-css="1w2u0m3">.css-1w2u0m3{padding:1rem;color:var(--theme-ui-colors-text,hsl(210,38%,95%));background-color:var(--theme-ui-colors-background,hsl(285,5%,17%));border-radius:0.25rem;overflow-x:auto;font-family:"IBM Plex Mono","JetBrains Mono","Fira Code","Input Mono",Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;padding:1rem;padding-top:0.5rem;margin-top:0;font-size:0.875rem;color:var(--theme-ui-colors-text,hsl(210,38%,95%));background-color:var(--theme-ui-colors-background,hsl(285,5%,17%));overflow-x:auto;border-radius:0 0 0.25rem 0.25rem;font-family:"IBM Plex Mono","JetBrains Mono","Fira Code","Input Mono",Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;}.css-1w2u0m3 .comment,.css-1w2u0m3 .prolog,.css-1w2u0m3 .doctype,.css-1w2u0m3 .cdata{color:var(--theme-ui-colors-code7,#999988);font-style:italic;}.css-1w2u0m3 .namespace{opacity:0.7;}.css-1w2u0m3 .string,.css-1w2u0m3 .attr-value,.css-1w2u0m3 .punctuation,.css-1w2u0m3 .tag.script-punctuation,.css-1w2u0m3 .tag.attr-value.punctuation{color:var(--theme-ui-colors-code3,#ffd866);}.css-1w2u0m3 .entity,.css-1w2u0m3 .url,.css-1w2u0m3 .symbol,.css-1w2u0m3 .number,.css-1w2u0m3 .boolean,.css-1w2u0m3 .constant,.css-1w2u0m3 .property,.css-1w2u0m3 .regex,.css-1w2u0m3 .inserted,.css-1w2u0m3 .attr-value,.css-1w2u0m3 .tag.attr-value{color:var(--theme-ui-colors-text,hsl(210,38%,95%));}.css-1w2u0m3 .function,.css-1w2u0m3 .tag.function,.css-1w2u0m3 .deleted,.css-1w2u0m3 .variable,.css-1w2u0m3 .unit{color:var(--theme-ui-colors-code3,#ffd866);}.css-1w2u0m3 .function-variable{color:var(--theme-ui-colors-code6,#ab9df2);}.css-1w2u0m3 .tag,.css-1w2u0m3 .keyword,.css-1w2u0m3 .selector,.css-1w2u0m3 .attr-name,.css-1w2u0m3 .tag.attr-name{color:var(--theme-ui-colors-code5,#78dce8);}.css-1w2u0m3 .symbol,.css-1w2u0m3 .tag.punctuation{color:var(--theme-ui-colors-code7,#999988);}.css-1w2u0m3 .property,.css-1w2u0m3 .number{color:var(--theme-ui-colors-code6,#ab9df2);}.css-1w2u0m3 .rule,.css-1w2u0m3 .class-name,.css-1w2u0m3 .keyword.module,.css-1w2u0m3 .operator,.css-1w2u0m3 .tag{color:var(--theme-ui-colors-code1,hsl(345,100%,69%));}.css-1w2u0m3 .function,.css-1w2u0m3 .tag.function{color:var(--theme-ui-colors-code4,#a9dc76);}.css-1w2u0m3::-webkit-scrollbar{width:0.5rem;height:0.5rem;}.css-1w2u0m3::-webkit-scrollbar:hover{width:1rem;height:1rem;}.css-1w2u0m3::-webkit-scrollbar-track{background-color:var(--theme-ui-colors-scrollbar,hsl(285,5%,12%));}.css-1w2u0m3::-webkit-scrollbar-thumb{background-color:var(--theme-ui-colors-muted,hsl(210,5%,40%));}</style><pre class="language-toml prism-code language-toml css-1w2u0m3"><div class="token-line"><style data-emotion-css="1baulvz">.css-1baulvz{display:inline-block;}</style><span class="token plain css-1baulvz">[[proxyservice]]</span></div><div class="token-line"><span class="token plain css-1baulvz">name = &quot;ecobee&quot;</span></div><div class="token-line"><span class="token plain css-1baulvz">servicetype = &quot;_hap._tcp&quot;</span></div><div class="token-line"><span class="token plain css-1baulvz">domain = &quot;&quot;</span></div><div class="token-line"><span class="token plain css-1baulvz">port = 1200</span></div><div class="token-line"><span class="token plain css-1baulvz">host = &quot;ecobee&quot;</span></div><div class="token-line"><span class="token plain css-1baulvz">ip = &quot;192.168.0.1&quot;</span></div><div class="token-line"><span class="token plain css-1baulvz">textdata = [</span></div><div class="token-line"><span class="token plain css-1baulvz">    &quot;MFG=ecobee Inc.&quot;</span></div><div class="token-line"><span class="token plain css-1baulvz">]</span></div></pre></div><p class="css-mfqae4">which broadcasts the relevant Bonjour service to be discovered. The beauty of this system is it can be setup on any linux/mac device and can be used from a single multi-arch docker image. Meaning you can easily run it with something like:</p><div class="css-byi6om"><div class="css-4aw43z"><style data-emotion-css="1u2sznp">.css-1u2sznp{position:absolute;top:0;left:1rem;font-family:"IBM Plex Mono","JetBrains Mono","Fira Code","Input Mono",Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:0.7rem;background-color:hsla(198,40%,60%,0.5);text-transform:uppercase;padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem;line-height:1;border-radius:0 0 0.2rem 0.2rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;height:auto;}</style><style data-emotion-css="1u9bgso">.css-1u9bgso{box-sizing:border-box;margin:0;min-width:0;position:absolute;top:0;left:1rem;font-family:"IBM Plex Mono","JetBrains Mono","Fira Code","Input Mono",Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:0.7rem;background-color:hsla(198,40%,60%,0.5);text-transform:uppercase;padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem;line-height:1;border-radius:0 0 0.2rem 0.2rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;height:auto;}</style><div class="css-1u9bgso">bash</div><button class="css-pbbfx5">Copy</button></div><pre class="language-bash prism-code language-bash css-1w2u0m3"><div class="token-line"><span class="token function css-1baulvz">docker</span><span class="token plain css-1baulvz"> run -itd </span><span class="token punctuation css-1baulvz">\</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    --restart</span><span class="token operator css-1baulvz">=</span><span class="token plain css-1baulvz">always </span><span class="token punctuation css-1baulvz">\</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    --net</span><span class="token operator css-1baulvz">=</span><span class="token plain css-1baulvz">host </span><span class="token punctuation css-1baulvz">\</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    --name</span><span class="token operator css-1baulvz">=</span><span class="token plain css-1baulvz">bonjourproxy </span><span class="token punctuation css-1baulvz">\</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    -v /mnt/data/supervisor/share/bonjourproxy/services.toml:/app/services.toml:ro </span><span class="token punctuation css-1baulvz">\</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    antoniomika/bonjourproxy:latest</span></div></pre></div><p class="css-mfqae4">If you&#x27;re using Home Assistant, there are some changes that you may need to make in order for this to work. Namely, these changes add retry logic to the pairing mechanism.</p><p class="css-mfqae4">Here&#x27;s a diff of the changes I introduced using a custom component:</p><div class="css-byi6om"><div class="css-4aw43z"><style data-emotion-css="1ic47ra">.css-1ic47ra{position:absolute;top:0;left:1rem;font-family:"IBM Plex Mono","JetBrains Mono","Fira Code","Input Mono",Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:0.7rem;background-color:hsla(76,40%,60%,0.5);text-transform:uppercase;padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem;line-height:1;border-radius:0 0 0.2rem 0.2rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;height:auto;}</style><style data-emotion-css="6nu4qj">.css-6nu4qj{box-sizing:border-box;margin:0;min-width:0;position:absolute;top:0;left:1rem;font-family:"IBM Plex Mono","JetBrains Mono","Fira Code","Input Mono",Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:0.7rem;background-color:hsla(76,40%,60%,0.5);text-transform:uppercase;padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem;line-height:1;border-radius:0 0 0.2rem 0.2rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;height:auto;}</style><div class="css-6nu4qj">diff</div><button class="css-pbbfx5">Copy</button></div><pre class="language-diff prism-code language-diff css-1w2u0m3"><div class="token-line"><span class="token coord css-1baulvz">--- a/homeassistant/components/homekit_controller/config_flow.py</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token coord css-1baulvz">+++ b/config/custom_components/homekit_controller/config_flow.py</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">@@ -313,6 +313,7 @@ class HomekitControllerFlowHandler(config_entries.ConfigFlow):</span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">        # volatile. We do cache it, but not against the config entry.</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">        # So copy the pairing data and mutate the copy.</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">        pairing_data = pairing.pairing_data.copy()</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz">        _LOGGER.debug(pairing_data)</span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">        # Use the accessories data from the pairing operation if it is</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">        # available. Otherwise request a fresh copy from the API.</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token plain css-1baulvz">@@ -320,9 +321,19 @@ class HomekitControllerFlowHandler(config_entries.ConfigFlow):</span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">        # the same time.</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">        accessories = pairing_data.pop(&quot;accessories&quot;, None)</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">        if not accessories:</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token deleted-sign deleted prefix deleted css-1baulvz">-</span><span class="token deleted-sign deleted line css-1baulvz">            accessories = await pairing.list_accessories_and_characteristics()</span></div><div class="token-line"><span class="token deleted-sign deleted line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz">            _LOGGER.debug(&quot;Attempting to load accessories and characteristics&quot;)</span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz">            while True:</span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz">                try:</span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz">                    accessories = await pairing.list_accessories_and_characteristics()</span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz">                except Exception:</span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz">                    _LOGGER.exception(&quot;Handled exception and retrying&quot;)</span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz">                    continue</span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz">                break</span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">        bridge_info = get_bridge_information(accessories)</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">        name = get_accessory_name(bridge_info)</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz">        _LOGGER.debug(bridge_info)</span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz">        _LOGGER.debug(name)</span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz"></span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">        return self.async_create_entry(title=name, data=pairing_data)</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token plain css-1baulvz">diff --git a/homeassistant/components/homekit_controller/connection.py b/config/custom_components/homekit_controller/connection.py</span></div><div class="token-line"><span class="token plain css-1baulvz">index 9d8eb00b54..61626310d4 100644</span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token coord css-1baulvz">--- a/homeassistant/components/homekit_controller/connection.py</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token coord css-1baulvz">+++ b/config/custom_components/homekit_controller/connection.py</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">@@ -140,7 +140,12 @@ class HKDevice:</span></div><div class="token-line"><span class="token plain css-1baulvz">
</span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">    async def async_setup(self):</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">        &quot;&quot;&quot;Prepare to use a paired HomeKit device in Home Assistant.&quot;&quot;&quot;</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz">        _LOGGER.debug(self)</span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz"></span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">        cache = self.hass.data[ENTITY_MAP].get_map(self.unique_id)</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz"></span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz">        _LOGGER.debug(cache)</span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz"></span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">        if not cache:</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">            if await self.async_refresh_entity_map(self.config_num):</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">                self._polling_interval_remover = async_track_time_interval(</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token plain css-1baulvz">@@ -152,6 +157,8 @@ class HKDevice:</span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">        self.accessories = cache[&quot;accessories&quot;]</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">        self.config_num = cache[&quot;config_num&quot;]</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz">        _LOGGER.debug(cache)</span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz"></span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">        self.entity_map = Accessories.from_list(self.accessories)</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">        self._polling_interval_remover = async_track_time_interval(</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token plain css-1baulvz">@@ -208,7 +215,13 @@ class HKDevice:</span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">    async def async_refresh_entity_map(self, config_num):</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">        &quot;&quot;&quot;Handle setup of a HomeKit accessory.&quot;&quot;&quot;</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">        try:</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token deleted-sign deleted prefix deleted css-1baulvz">-</span><span class="token deleted-sign deleted line css-1baulvz">            self.accessories = await self.pairing.list_accessories_and_characteristics()</span></div><div class="token-line"><span class="token deleted-sign deleted line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz">            while True:</span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz">                try:</span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz">                    self.accessories = await self.pairing.list_accessories_and_characteristics()</span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz">                except Exception:</span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz">                    _LOGGER.exception(&quot;Setting up the accessory&quot;)</span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz">                    continue</span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token inserted-sign inserted prefix inserted css-1baulvz">+</span><span class="token inserted-sign inserted line css-1baulvz">                break</span></div><div class="token-line"><span class="token inserted-sign inserted line css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">        except AccessoryDisconnectedError:</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">            # If we fail to refresh this data then we will naturally retry</span></div><div class="token-line"><span class="token unchanged line css-1baulvz"></span><span class="token unchanged prefix unchanged css-1baulvz"> </span><span class="token unchanged line css-1baulvz">            # later when Bonjour spots c# is still not up to date.</span></div></pre></div><style data-emotion-css="1reecjh">.css-1reecjh{box-sizing:border-box;margin:0;min-width:0;margin-top:2.5rem;padding-top:1.5rem;border-top:2px solid;border-top-color:var(--theme-ui-colors-background,hsl(285,5%,17%));}</style><div class="css-1reecjh"><div class="css-4cffwv"><style data-emotion-css="wts7qx">.css-wts7qx{box-sizing:border-box;margin:0;min-width:0;-webkit-transition:all 200ms ease-in-out;transition:all 200ms ease-in-out;}.css-wts7qx:link,.css-wts7qx:visited{font-weight:700;color:var(--theme-ui-colors-text,hsl(210,38%,95%));-webkit-text-decoration:none;text-decoration:none;border-bottom:2px solid;border-bottom-color:var(--theme-ui-colors-primary,hsl(345,100%,69%));}.css-wts7qx:hover,.css-wts7qx:focus{color:var(--theme-ui-colors-primary,hsl(345,100%,69%));}</style><a href="https://github.com/antoniomika/notes/tree/master/notes/bonjour-across-subnets.md" class="css-wts7qx">Edit this page</a></div><p><style data-emotion-css="mcqe72">.css-mcqe72{box-sizing:border-box;margin:0;min-width:0;font-family:"IBM Plex Mono","JetBrains Mono","Fira Code","Input Mono",Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:0.7rem;opacity:0.7;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:inline-block;}</style><div class="css-mcqe72">Date: <!-- -->2020-08-15</div></p></div></article></div></main><style data-emotion-css="8jmlm3">.css-8jmlm3{width:50%;position:fixed;top:0;right:0;left:0;bottom:0;overflow-x:hidden;overflow-y:auto;padding-top:1.5rem;padding-bottom:4rem;}@media screen and (min-width:40em){.css-8jmlm3{width:240px;right:auto;}}</style><style data-emotion-css="1myka1i">.css-1myka1i{box-sizing:border-box;margin:0;min-width:0;width:50%;position:fixed;top:0;right:0;left:0;bottom:0;overflow-x:hidden;overflow-y:auto;padding-top:1.5rem;padding-bottom:4rem;}@media screen and (min-width:40em){.css-1myka1i{width:240px;right:auto;}}</style><header class="css-1myka1i"><style data-emotion-css="xo0iyu">.css-xo0iyu{box-sizing:border-box;margin:0;min-width:0;padding-left:1rem;padding-right:1rem;margin-bottom:1rem;}</style><div class="css-xo0iyu"><style data-emotion-css="19p2wcd">.css-19p2wcd{box-sizing:border-box;margin:0;min-width:0;margin-bottom:1rem;}</style><div class="css-19p2wcd"><style data-emotion-css="16ecpcm">.css-16ecpcm{box-sizing:border-box;margin:0;min-width:0;max-width:100%;height:auto;max-width:100%;display:block;}</style><img src="https://antoniomika.me/icon.jpg" class="css-16ecpcm"/></div><div class="css-19p2wcd"><style data-emotion-css="1tj03ch">.css-1tj03ch{color:var(--theme-ui-colors-text,hsl(210,38%,95%));line-height:1.375;font-weight:700;}</style><style data-emotion-css="1smtvtc">.css-1smtvtc{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-text,hsl(210,38%,95%));line-height:1.375;font-weight:700;}</style><div class="css-1smtvtc">A personal blog and note taking site</div></div></div><style data-emotion-css="155za0w">.css-155za0w{list-style-type:none;}</style><style data-emotion-css="16d60vq">.css-16d60vq{box-sizing:border-box;margin:0;min-width:0;list-style-type:none;}</style><nav class="css-16d60vq"><style data-emotion-css="1lejymi">.css-1lejymi{text-transform:uppercase;}</style><style data-emotion-css="1ixsdi0">.css-1ixsdi0{box-sizing:border-box;margin:0;min-width:0;color:inherit;-webkit-text-decoration:none;text-decoration:none;font-weight:700;display:inline-block;padding-left:1rem;padding-right:1rem;padding-top:0.25rem;padding-bottom:0.25rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-weight:400;font-family:"IBM Plex Mono","JetBrains Mono","Fira Code","Input Mono",Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:0.875rem;-webkit-transition:all 200ms ease-in-out;transition:all 200ms ease-in-out;text-transform:uppercase;}.css-1ixsdi0:hover,.css-1ixsdi0:focus,.css-1ixsdi0.active{color:var(--theme-ui-colors-primary,hsl(345,100%,69%));}.css-1ixsdi0:hover,.css-1ixsdi0:focus{background-color:var(--theme-ui-colors-navHover,hsl(285,5%,13%));color:var(--theme-ui-colors-text,hsl(210,38%,95%));}</style><a class="css-1ixsdi0" href="/">All Notes</a><style data-emotion-css="bp6y7h">.css-bp6y7h{padding-left:1rem;padding-right:1rem;padding-top:0.5rem;padding-bottom:0.25rem;font-family:"IBM Plex Mono","JetBrains Mono","Fira Code","Input Mono",Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;text-transform:uppercase;font-size:0.875rem;}</style><style data-emotion-css="12w5a9y">.css-12w5a9y{box-sizing:border-box;margin:0;min-width:0;padding-left:1rem;padding-right:1rem;padding-top:0.5rem;padding-bottom:0.25rem;font-family:"IBM Plex Mono","JetBrains Mono","Fira Code","Input Mono",Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;text-transform:uppercase;font-size:0.875rem;}</style><div class="css-12w5a9y">Tags</div><style data-emotion-css="22fc79">.css-22fc79{box-sizing:border-box;margin:0;min-width:0;color:inherit;-webkit-text-decoration:none;text-decoration:none;font-weight:700;display:inline-block;padding-left:1rem;padding-right:1rem;padding-top:0.25rem;padding-bottom:0.25rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-weight:400;font-family:"IBM Plex Mono","JetBrains Mono","Fira Code","Input Mono",Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:0.875rem;-webkit-transition:all 200ms ease-in-out;transition:all 200ms ease-in-out;}.css-22fc79:hover,.css-22fc79:focus,.css-22fc79.active{color:var(--theme-ui-colors-primary,hsl(345,100%,69%));}.css-22fc79:hover,.css-22fc79:focus{background-color:var(--theme-ui-colors-navHover,hsl(285,5%,13%));color:var(--theme-ui-colors-text,hsl(210,38%,95%));}</style><a class="css-22fc79" href="/tag/blog"><style data-emotion-css="1lexr7c">.css-1lexr7c{box-sizing:border-box;margin:0;min-width:0;background-color:hsla(355,40%,60%,0.5);width:10px;height:10px;border-radius:50%;margin-right:0.5em;}</style><div class="css-1lexr7c"></div>blog</a></nav><style data-emotion-css="13s5gr5">.css-13s5gr5{position:fixed;left:0;width:50%;bottom:0;background-color:var(--theme-ui-colors-backgroundTransparent,hsla(285,5%,17%,0.72));padding-top:1rem;padding-bottom:1rem;}@media screen and (min-width:40em){.css-13s5gr5{width:240px;}}</style><style data-emotion-css="o7758">.css-o7758{box-sizing:border-box;margin:0;min-width:0;position:fixed;left:0;width:50%;bottom:0;background-color:var(--theme-ui-colors-backgroundTransparent,hsla(285,5%,17%,0.72));padding-top:1rem;padding-bottom:1rem;}@media screen and (min-width:40em){.css-o7758{width:240px;}}</style><div class="css-o7758"><style data-emotion-css="1rxgw8g">.css-1rxgw8g{color:var(--theme-ui-colors-text,hsl(210,38%,95%));z-index:11;padding:0;display:block;margin-left:auto;margin-right:auto;-webkit-transition:all 200ms ease-in-out;transition:all 200ms ease-in-out;cursor:pointer;}.css-1rxgw8g:hover{color:var(--theme-ui-colors-primary,hsl(345,100%,69%));}</style><style data-emotion-css="naqdmg">.css-naqdmg{box-sizing:border-box;margin:0;min-width:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding:0.25rem;width:32px;height:32px;color:inherit;background-color:transparent;border:none;border-radius:4px;color:var(--theme-ui-colors-text,hsl(210,38%,95%));z-index:11;padding:0;display:block;margin-left:auto;margin-right:auto;-webkit-transition:all 200ms ease-in-out;transition:all 200ms ease-in-out;cursor:pointer;}.css-naqdmg:hover{color:var(--theme-ui-colors-primary,hsl(345,100%,69%));}</style><button aria-label="Toggle dark mode" class="css-naqdmg"><svg width="1.5rem" height="1.5rem" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M912.1 512c0 20-1.4 39.9-4 59.7.5-3.5 1-7.1 1.4-10.6-5.2 38.4-15.5 75.9-30.5 111.6 1.3-3.2 2.7-6.4 4-9.6-14.8 34.8-34 67.6-57.1 97.6l6.3-8.1c-23 29.7-49.8 56.4-79.5 79.5l8.1-6.3c-30 23.1-62.8 42.3-97.6 57.1 3.2-1.3 6.4-2.7 9.6-4-35.7 15-73.2 25.3-111.6 30.6 3.5-.5 7.1-1 10.6-1.4a450.3 450.3 0 0 1-119.4 0c3.5.5 7.1 1 10.6 1.4-38.5-5.2-76-15.5-111.7-30.5 3.2 1.3 6.4 2.7 9.6 4-34.8-14.8-67.6-34-97.6-57.1l8.1 6.3c-29.7-23-56.4-49.8-79.5-79.5l6.3 8.1c-23.1-30-42.3-62.8-57.1-97.6 1.3 3.2 2.7 6.4 4 9.6-15-35.7-25.3-73.2-30.6-111.6.5 3.5 1 7.1 1.4 10.6a450.3 450.3 0 0 1 0-119.4c-.5 3.5-1 7.1-1.4 10.6 5.3-38.4 15.5-75.9 30.6-111.6-1.3 3.2-2.7 6.4-4 9.6 14.8-34.8 34-67.6 57.1-97.6l-6.3 8.1c23-29.7 49.8-56.4 79.5-79.5l-8.1 6.3c30-23.1 62.8-42.3 97.6-57.1-3.2 1.3-6.4 2.7-9.6 4 35.7-15 73.2-25.3 111.6-30.6-3.5.5-7.1 1-10.6 1.4 39.6-5.3 79.8-5.3 119.4 0-3.5-.5-7.1-1-10.6-1.4 38.4 5.3 75.9 15.5 111.6 30.6-3.2-1.3-6.4-2.7-9.6-4 34.8 14.8 67.6 34 97.6 57.1l-8.1-6.3c29.7 23 56.4 49.8 79.5 79.5l-6.3-8.1c23.1 30 42.3 62.8 57.1 97.6-1.3-3.2-2.7-6.4-4-9.6 15 35.7 25.3 73.2 30.6 111.6-.5-3.5-1-7.1-1.4-10.6 2.7 19.7 4 39.6 4 59.6 0 20.9 18.4 41 40 40s40-17.6 40-40c-.1-49.6-7.6-99.8-22.9-146.9-14.8-45.6-36.2-89.4-64-128.5-14.6-20.5-30.6-40.3-48.1-58.5-17.6-18.2-36.8-34.5-56.9-49.9-38-29.1-80.5-51.4-125.3-67.9-46.3-17.1-95.9-26.1-145.2-28.1-49.8-2-100.5 4.1-148.5 17.7-46.1 13.1-90.9 33.3-131 59.7-39.7 26.1-76 57.8-106.2 94.4-16.1 19.5-31.1 40-44.1 61.7-13.2 21.9-24 45-33.7 68.6-18.8 45.7-29.2 94.3-33 143.4-3.8 49.7.7 100.4 12.5 148.9C57 673.3 75.9 718.9 100.8 760c24.6 40.5 55.3 78 90.8 109.5 35.7 31.7 75.7 58.7 119.2 78.4 23.5 10.6 47.5 19.9 72.3 26.8 25.4 7.1 51.3 11.5 77.4 14.5 50 5.8 100.9 2.8 150.2-7.3 47.3-9.6 93.5-27.2 135.6-50.7 41.2-23 79.4-52.6 112.1-86.7 32.8-34.3 61.2-73.7 82.3-116.3 21.7-43.6 37.5-90.2 44.9-138.4 4-25.8 6.5-51.7 6.5-77.8 0-20.9-18.4-41-40-40-21.7 1-39.9 17.6-40 40z"></path><path d="M512 187.7v648.6c-179.1 0-324-145.2-324-324.3s144.9-324.3 324-324.3z"></path><path d="M482 187.7v569c0 26.2-.6 52.4 0 78.6v1.1l30-30c-14.4 0-28.8-1-43.1-2.8 2.7.4 5.3.7 8 1.1-28.6-3.9-56.5-11.5-83.1-22.6l7.2 3c-15-6.4-29.5-13.9-43.4-22.4-6.7-4.1-13.3-8.5-19.7-13.1-1.6-1.2-3.2-2.3-4.8-3.5-.8-.6-2.1-1.2-2.6-2-.1-.1 6.4 5.1 3 2.3-3.2-2.6-6.5-5.2-9.6-7.9-12.1-10.3-23.5-21.5-34.1-33.5-2.6-3-5.1-6-7.6-9-1.1-1.4-2.2-2.7-3.3-4.1-.5-.7-1.1-1.4-1.6-2.1 6.1 7.7 2.9 3.7 1.5 1.9-4.9-6.5-9.5-13.1-13.8-20-9.9-15.4-18.4-31.7-25.5-48.5l3 7.2c-11.2-26.6-18.8-54.5-22.6-83.1.4 2.7.7 5.3 1.1 8-3.7-28.6-3.7-57.6 0-86.2-.4 2.7-.7 5.3-1.1 8 3.9-28.6 11.4-56.5 22.6-83.1l-3 7.2c6.4-15 13.8-29.6 22.4-43.5 4.1-6.7 8.5-13.3 13.1-19.7 1.1-1.6 2.3-3.2 3.5-4.8.5-.7 1.2-2.2 2-2.6.1-.1-5 6.4-2.3 3 2.6-3.3 5.2-6.5 7.9-9.7 10.3-12.2 21.5-23.6 33.4-34.1 3-2.6 5.9-5.1 9-7.6 1.4-1.1 2.7-2.2 4.1-3.3.7-.5 1.4-1.1 2.1-1.6-7.6 6.1-3.7 2.9-1.9 1.5 6.5-4.9 13.1-9.5 19.9-13.9 15.4-9.9 31.6-18.4 48.4-25.6l-7.2 3c26.6-11.2 54.5-18.8 83.1-22.6-2.7.4-5.3.7-8 1.1 14.3-1.9 28.7-2.8 43.1-2.8 15.7 0 30.7-13.8 30-30-.7-16.2-13.2-30-30-30-72.2.2-144.6 22.3-203.4 64.4-59.5 42.6-104.5 101.2-129.7 170-25.2 68.6-27.5 146.1-7.6 216.3C190.5 676.5 230.6 739.1 285 784c57.5 47.4 126.9 75.7 201.2 81.6 8.6.7 17.3 1 25.9 1 16.2 0 30-13.8 30-30v-64.5-155-187.5-162c0-26.2.5-52.4 0-78.6v-1.1c0-15.7-13.8-30.7-30-30-16.4.5-30.1 13-30.1 29.8z"></path></svg></button></div></header></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/bonjour-across-subnets/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-396860297e70ece2e141.js"],"app":["/app-c6ef5c2f96254335c1a0.js"],"component---node-modules-gatsby-theme-code-notes-src-pages-404-tsx":["/component---node-modules-gatsby-theme-code-notes-src-pages-404-tsx-302a9fe8a78274bbcffa.js"],"component---src-gatsby-theme-code-notes-templates-note-js":["/component---src-gatsby-theme-code-notes-templates-note-js-b0f61fea6533f3ee3656.js"],"component---src-gatsby-theme-code-notes-templates-notes-js":["/component---src-gatsby-theme-code-notes-templates-notes-js-608bb00094014405ff17.js"],"component---src-gatsby-theme-code-notes-templates-tag-page-js":["/component---src-gatsby-theme-code-notes-templates-tag-page-js-a8613c3228ddadd58b9e.js"]};/*]]>*/</script><script src="/polyfill-396860297e70ece2e141.js" nomodule=""></script><script src="/component---src-gatsby-theme-code-notes-templates-note-js-b0f61fea6533f3ee3656.js" async=""></script><script src="/commons-0b008caf945293618b83.js" async=""></script><script src="/app-c6ef5c2f96254335c1a0.js" async=""></script><script src="/1bfc9850-284bb63085f6cc17369b.js" async=""></script><script src="/framework-643cd9d57cfac08fd2c4.js" async=""></script><script src="/webpack-runtime-6c5d3617d53de854ad20.js" async=""></script></body></html>